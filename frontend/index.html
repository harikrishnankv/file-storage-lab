<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Storage Lab - UUID v1 Attack Demonstration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-cloud-upload-alt me-2"></i>
                File Storage Lab
            </a>
            <div class="navbar-nav ms-auto">
                <div id="auth-buttons" class="d-flex gap-2">
                    <button class="btn btn-outline-light" onclick="showLoginModal()">
                        <i class="fas fa-sign-in-alt me-1"></i>Login
                    </button>
                    <button class="btn btn-light" onclick="showRegisterModal()">
                        <i class="fas fa-user-plus me-1"></i>Register
                    </button>
                </div>
                <div id="user-menu" class="d-flex align-items-center gap-3" style="display: none;">
                    <span class="text-light">
                        <i class="fas fa-user me-1"></i>
                        <span id="current-username"></span>
                        <span id="user-role-badge" class="badge bg-warning ms-1"></span>
                    </span>
                    <button class="btn btn-outline-danger btn-sm" onclick="deleteOwnAccount()">
                        <i class="fas fa-user-times me-1"></i>Delete Account
                    </button>
                    <button class="btn btn-outline-light btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-1"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Welcome Section -->
        <div id="welcome-section" class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cloud-upload-alt me-2"></i>Welcome to File Storage</h5>
                    </div>
                    <div class="card-body">
                        <p>Upload, manage, and organize your files securely. Each user has their own private file storage space.</p>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-upload fa-3x text-primary mb-3"></i>
                                    <h6>Upload Files</h6>
                                    <p class="text-muted">Store your documents, images, and files</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-shield-alt fa-3x text-success mb-3"></i>
                                    <h6>Secure Storage</h6>
                                    <p class="text-muted">Your files are private and secure</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-mobile-alt fa-3x text-info mb-3"></i>
                                    <h6>Access Anywhere</h6>
                                    <p class="text-muted">Access your files from any device</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Management Section -->
        <div id="file-section" style="display: none;">
            <!-- File Upload Section - Top Full Width -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-upload me-2"></i>Upload File</h5>
                            <button class="btn btn-primary" onclick="showUploadModal()">
                                <i class="fas fa-upload me-1"></i>Upload File
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Two Column Section: Files List and Live Activity -->
            <div class="row mt-4">
                <!-- My Files List - Left Side -->
                <div class="col-lg-8 col-xl-8">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-folder me-2"></i>My Files</h5>
                        </div>
                        <div class="card-body">
                            <div id="files-container">
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                    <p>Loading files...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Live Activity Feed - Right Side -->
                <div class="col-lg-4 col-xl-4">
                    <div class="card sticky-top" style="top: 20px; position: sticky;">
                        <div class="card-header bg-warning bg-opacity-10">
                            <h6 class="mb-0">
                                <i class="fas fa-bolt me-2 text-warning"></i>Live Activity
                            </h6>
                        </div>
                        <div class="card-body p-2" style="max-height: 70vh; overflow-y: auto;">
                            <div id="activity-feed">
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin mb-2"></i>
                                    <p class="small mb-0">Loading activity...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics Section - Below -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-bar me-2"></i>Application Statistics</h5>
                        </div>
                        <div class="card-body">
                            <div id="stats-container">
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                    <p>Loading statistics...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="row mt-4" style="display: none;">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-users me-2"></i>All Users</h5>
                    </div>
                    <div class="card-body">
                        <div id="users-container">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                <p>Loading users...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-files me-2"></i>All Files</h5>
                    </div>
                    <div class="card-body">
                        <div id="admin-files-container">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                <p>Loading files...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attack Tools Section (Admin Only) -->
        <div id="attack-tools-section" class="row mt-4" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-tools me-2 text-warning"></i>Security Testing Tools</h5>
                        <small class="text-muted">Admin access only - For security assessment purposes</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card border-danger">
                                    <div class="card-header bg-danger text-white">
                                        <h6><i class="fas fa-search me-2"></i>File Enumeration</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">Generate adjacent file IDs to enumerate uploaded files.</p>
                                        <button class="btn btn-outline-danger btn-sm" onclick="showFileEnumerationTool()">
                                            <i class="fas fa-play me-1"></i>Start Test
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark">
                                        <h6><i class="fas fa-user-secret me-2"></i>User Discovery</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">Discover user accounts using predictable user IDs.</p>
                                        <button class="btn btn-outline-warning btn-sm" onclick="showUserDiscoveryTool()">
                                            <i class="fas fa-play me-1"></i>Start Test
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h6><i class="fas fa-key me-2"></i>Session Hijacking</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">Attempt session hijacking using predictable tokens.</p>
                                        <button class="btn btn-outline-info btn-sm" onclick="showSessionHijackingTool()">
                                            <i class="fas fa-play me-1"></i>Start Test
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-sign-in-alt me-2"></i>Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-link btn-sm" onclick="showForgotPasswordModal()">
                                Forgot Password?
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="login()">Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Register</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="registerUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="registerPassword" required minlength="6">
                        </div>
                        <div class="mb-3">
                            <label for="registerPasswordConfirm" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="registerPasswordConfirm" required minlength="6">
                        </div>
                        <div class="mb-3">
                            <label for="securityQuestion" class="form-label">Security Question</label>
                            <select class="form-control" id="securityQuestion" required>
                                <option value="">Select a security question</option>
                                <option value="What is your mother's maiden name?">What is your mother's maiden name?</option>
                                <option value="What city were you born in?">What city were you born in?</option>
                                <option value="What was the name of your first pet?">What was the name of your first pet?</option>
                                <option value="What was your first car?">What was your first car?</option>
                                <option value="What is your favorite movie?">What is your favorite movie?</option>
                                <option value="What is your favorite color?">What is your favorite color?</option>
                                <option value="What is your favorite food?">What is your favorite food?</option>
                                <option value="What is your favorite sport?">What is your favorite sport?</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="securityAnswer" class="form-label">Security Answer</label>
                            <input type="text" class="form-control" id="securityAnswer" required>
                            <div class="form-text">This will be used to reset your password if forgotten</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="register()">Register</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-key me-2"></i>Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="forgotUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="forgotUsername" required>
                        </div>
                        <div class="mb-3" id="securityQuestionDiv" style="display: none;">
                            <label for="forgotSecurityAnswer" class="form-label" id="securityQuestionLabel"></label>
                            <input type="text" class="form-control" id="forgotSecurityAnswer" required>
                        </div>
                        <div class="mb-3" id="newPasswordDiv" style="display: none;">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required minlength="6">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="forgotPasswordBtn" onclick="getSecurityQuestion()">Get Security Question</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-upload me-2"></i>Upload File</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="multipleFilesCheck" onchange="toggleMultipleFiles()">
                                <label class="form-check-label" for="multipleFilesCheck">
                                    <i class="fas fa-layer-group me-1"></i>Upload Multiple Files
                                </label>
                            </div>
                            <label for="fileInput" class="form-label">Select File<span id="filesCount"></span></label>
                            <input type="file" class="form-control" id="fileInput" required>
                            <div class="form-text">Supported formats: txt, pdf, png, jpg, jpeg, gif, doc, docx, zip</div>
                            <div id="selectedFilesList" class="mt-2" style="display: none;"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="uploadFile()">Upload</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attack Tools Modals -->
    <div class="modal fade" id="attackModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="attackModalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="attackModalBody">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" id="attackModalAction" onclick="executeAttack()">Execute Attack</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/app.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/file-manager.js"></script>
</body>
</html>
